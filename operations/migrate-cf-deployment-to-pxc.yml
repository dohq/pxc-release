---
- type: replace
  path: /instance_groups/name=database/jobs/name=mysql/properties/cf_mysql_enabled?
  value: false

- type: replace
  path: /instance_groups/name=database/jobs/-
  value:
    name: mysql-clustered
    properties:
      pxc_enabled: true
      admin_password: "((cf_mysql_mysql_admin_password))"
      binlog_enabled: false
      cluster_health:
        password: "((cf_mysql_mysql_cluster_health_password))"
      galera_healthcheck:
        db_password: "((cf_mysql_mysql_galera_healthcheck_password))"
        endpoint_username: galera_healthcheck
        endpoint_password: "((cf_mysql_mysql_galera_healthcheck_endpoint_password))"
      port: 13306
      seeded_databases:
      - name: cloud_controller
        username: cloud_controller
        password: "((cc_database_password))"
      - name: diego
        username: diego
        password: "((diego_database_password))"
      - name: network_connectivity
        username: network_connectivity
        password: "((network_connectivity_database_password))"
      - name: network_policy
        username: network_policy
        password: "((network_policy_database_password))"
      - name: routing-api
        username: routing-api
        password: "((routing_api_database_password))"
      - name: uaa
        username: uaa
        password: "((uaa_database_password))"
      - name: locket
        username: locket
        password: "((locket_database_password))"
      tls:
        galera: ((galera_server_certificate))
        server: ((mysql_server_certificate))
    release: pxc

- type: replace
  path: /releases/-
  value:
    name: pxc
    version: create
    url: //Users/pivotal/workspace/pxc-release

- type: replace
  path: /variables/-
  value:
    name: galera_ca
    type: certificate
    options:
      is_ca: true
      common_name: galera_ca_new

- type: replace
  path: /variables/-
  value:
    name: mysql_server_ca
    type: certificate
    options:
      is_ca: true
      common_name: mysql_server_ca

- type: replace
  path: /variables/-
  value:
    name: galera_server_certificate
    type: certificate
    options:
      ca: galera_ca
      extended_key_usage: [ "server_auth", "client_auth" ]

- type: replace
  path: /variables/-
  value:
    name: mysql_server_certificate
    type: certificate
    options:
      ca: mysql_server_ca
      common_name: "sql-db.service.cf.internal"
